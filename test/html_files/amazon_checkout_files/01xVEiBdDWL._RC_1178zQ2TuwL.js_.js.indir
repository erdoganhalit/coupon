function _classCallCheck(c,b){if(!(c instanceof b))throw new TypeError("Cannot call a class as a function");}
(function(c){var b=window.AmazonUIPageJS||window.P,d=b._namespace||b.attributeErrors,a=d?d("AmazonKeyCheckoutAssets@csm","AmazonKeyCheckoutAssets"):b;a.guardFatal?a.guardFatal(c)(a,window):a.execute(function(){c(a,window)})})(function(c,b,d){c.register("AmazonKeyCheckoutAssets-CSM",function(){var a=function e(){_classCallCheck(this,e)};a.logError=function(a,c){try{if(b.ueLogError)return b.ueLogError(a,c),!0}catch(g){console.error("AmazonKeyCheckoutAssets-CSM | Failed to log error to CSM.",g)}return!1};
a.logMetric=function(a){if(!a||!a.data||!a.data.name)return console.error("AmazonKeyCheckoutAssets-CSM | Invalid metric data"),!1;try{if(b.ue&&b.ue.log)return b.ue.log(a.data,a.namespace||"AmazonKeyCheckoutAssets-CSM"),!0}catch(f){console.error("AmazonKeyCheckoutAssets-CSM | Failed to log error to CSM.",f)}return!1};return a})});
/* ******** */
var _createClass=function(){function b(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(a,d,c){d&&b(a.prototype,d);c&&b(a,c);return a}}();function _classCallCheck(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");}
(function(b){var a=window.AmazonUIPageJS||window.P,d=a._namespace||a.attributeErrors,c=d?d("AmazonKeyCheckoutAssets@updateEligibleKeyShipOption","AmazonKeyCheckoutAssets"):a;c.guardFatal?c.guardFatal(b)(c,window):c.execute(function(){b(c,window)})})(function(b,a,d){b.when("A","AmazonKeyCheckoutAssets-CSM","ready").register("AmazonKeyCheckoutAssets-UpdateEligibleKeyShipOptionCustomAction",function(c,b){var a=function(){function a(){_classCallCheck(this,a)}_createClass(a,[{key:"setup",value:function(){this.bindClickHandler()}},
{key:"bindClickHandler",value:function(){var a=this;c.declarative("update_to_key_shipping_option","click",function(e){return a.handleClickEvent(e)})}},{key:"handleClickEvent",value:function(a){var e=this;try{var b=a.data;b&&(this.displayStyle=b.displayStyle);if(b&&b.shipOptions){var c=this.extractShipOptions(b);c?this.selectRadiosByShipOptions(c).then(function(a){a?e.logMetric("ClickEventSuccess"):e.logMetric("ClickEventFailed","SelectionFailed")}):this.logErrorAndMetric("Handle click event failed. No shipOptions found in data attribute",
"ClickEventFailed","NoShipOptions")}else this.logErrorAndMetric("No declarative element with shipOptions found in click event","ClickEventFailed","NoDeclarativeElement")}catch(h){this.logErrorAndMetric("Handle click event failed: "+h.message,"ClickEventFailed","Error")}}},{key:"extractShipOptions",value:function(a){a=a.shipOptions.replaceAll("\x3d",":");return JSON.parse(a)}},{key:"selectRadiosByShipOptions",value:function(a){var b=this,c=0;return new Promise(function(e){function h(g){if(g>=a.length)e(0<
c);else{var d=a[g];if(d&&d.deliveryGroupId&&d.shipOptionId){var f=d.deliveryGroupId,k=d.shipOptionId;b.waitForSpinnerToDisappear().then(function(){b.selectRadioByNameAndValue(f,k).then(function(a){a&&c++;h(g+1)})})}else b.logError("Invalid option at index "+g),h(g+1)}}try{Array.isArray(a)?h(0):(b.logError("shipOptions is not an array"),e(!1))}catch(l){b.logError("Error selecting radio buttons: "+l.message),e(!1)}})}},{key:"selectRadioByNameAndValue",value:function(a,b){var c=this;return new Promise(function(e){var d=
'input[type\x3d"radio"][value*\x3d"'+b+'"][name\x3d"'+CSS.escape(a)+'"]:not(:checked)';(d=document.querySelector(d))?(d.click(),c.logMetric("RadioSelection",(d.checked?"Success":"Failure")+"_"+a+"_"+b),e(!0)):e(!1)})}},{key:"waitForSpinnerToDisappear",value:function(){var a=0<arguments.length&&arguments[0]!==d?arguments[0]:5E3;return new Promise(function(b){var c=function(){document.querySelector("#checkout-item-block-panel .section-overwrap")||(clearInterval(d),clearTimeout(e),b(!0))},d=setInterval(c,
100),e=setTimeout(function(){clearInterval(d);b(!1)},a);c()})}},{key:"logError",value:function(a){b.logError(Error(a),{logLevel:"ERROR",displayStyle:this.displayStyle,attribution:"AmazonKeyCheckoutAssets-UpdateEligibleKeyShipOptionCustomAction",message:a})}},{key:"logMetric",value:function(a,c){b.logMetric({data:{name:""+a,value:""+c,displayStyle:this.displayStyle},namespace:"AmazonKeyCheckoutAssets-UpdateEligibleKeyShipOptionCustomAction"})}},{key:"logErrorAndMetric",value:function(a,b,c){this.logError(a);
this.logMetric(b,c)}}]);return a}();a.instance=null;a.getInstance=function(){a.instance||(a.instance=new a);return a.instance};return a});b.when("AmazonKeyCheckoutAssets-UpdateEligibleKeyShipOptionCustomAction","ready").register("AmazonKeyCheckoutAssets-initialized",function(a){a.getInstance().setup();return!0})});
/* ******** */
