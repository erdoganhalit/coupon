(function(k){var d=window.AmazonUIPageJS||window.P,m=d._namespace||d.attributeErrors,b=m?m("CheckoutCartPrefetchAsset",""):d;b.guardFatal?b.guardFatal(k)(b,window):b.execute(function(){k(b,window)})})(function(k,d,m){k.when("A","CartServerSetting","CartCheckoutPrefetch-DeviceAgnosticFunctions").register("CartCheckoutPrefetchDesktop",function(b,A,g){function h(){return"/gp/buy/prefetch/store-html.html"}function f(){if(g.isTangoPreinitiateEligible())n=!1,g.javaCheckoutPreinitiate();else{n=!0;var b=
(new Date).getTime(),c="/gp/cart/checkout-prefetch.html?cartInitiateId\x3d"+b,d=g.getBuyBoxParameters(m),f;for(f in d)d.hasOwnProperty(f)&&(c+="\x26"+f+"\x3d"+encodeURIComponent(d[f]));g.streamJSONPrefetchRequest(c,"PreInitiate:",g.executionIdSuccessHandler,b);g.insertValueInBuyBox("cartInitiateId",b)}}function c(b){n&&e(b)}function e(b){function c(){5>q&&(g.fireAndForgetPrefetchRequest(b,"StoreHtml:"),q++,p=setTimeout(c,6E4))}l(d).ready(function(){p=setTimeout(c,6E4)})}var l=b.$,m=["partialCheckoutCart"],
p,q=0,n=!0,t=A.features.disableCheckoutPrefetchCaching;k.when("total-purchase-cost-prefetch-listeners").register("setupCartCheckoutPrefetch",function(){var d=!1,e=!1;t&&g.clearJavaPreinitValuesInBuyBox();b.state.bind("checkout-url-migration-page-state",function(b,d){g.customerEligibilityChangeHandler(b,d,f)});b.on("sc:checkout-prefetch:start",function(){d=!0});b.on("sc:checkout-prefetch:complete",function(){d=!1;e&&l("#sc-buy-box form").submit()});b.on("tango:checkout:eligible:skipGurupaPrefetch",
function(){d=!1;e&&l("#sc-buy-box form").submit()});l(document).delegate("#sc-buy-box form","submit",function(b){return d?(e=!0,b.preventDefault(),!1):!0});f();c(h());b.on("sc:checkout-prefetch",function(){clearTimeout(p);f();c(h())});b.on("affordability:clipCoupon:success",function(){f()});b.on("shopwithpoints:preferenceUpdate:success",function(b){f();g.logUECounter(b+"::TriggerPrefetchOnSuccess::Success",1)})})});"use strict";k.when("A").register("CartCheckoutPrefetch-DeviceAgnosticFunctions",function(b){function k(a,
z){b.trigger("sc:checkout-prefetch:start",{prefetchPromise:a});z&&(x=z)}function g(a){b.trigger("sc:checkout-prefetch:complete",a)}function h(a,b){"undefined"!==typeof d.ue&&"undefined"!==typeof d.ue.count&&d.ue.count(a,b||1)}function f(){var a=document.getElementById("sc-buy-box");if(a&&(a=a.getElementsByTagName("form"),0!==a.length))return a[0]}function c(a,b){var d=f();if(d){e(d,a);var c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("value",b);c.setAttribute("name",
a);d.appendChild(c)}}function e(a,b){if(a)for(var d=a.getElementsByTagName("input"),c=0;c<d.length;c++)d[c].name===b&&a.removeChild(d[c])}function l(){var a=f();a&&(e(a,"preInitiateExecutionId"),e(a,"preInitiatePurchaseId"),e(a,"isJavaPreinitiate"))}function w(a,b){b===x&&a&&a.executionHandle&&a.executionHandle.executionId&&(c("preInitiateExecutionId",a.executionHandle.executionId),a.executionHandle.purchaseId&&c("preInitiatePurchaseId",a.executionHandle.purchaseId),c("isJavaPreinitiate",1))}function p(){q();
y=setTimeout(l,3E5)}function q(){clearTimeout(y)}function n(a,b,c,f){if(d.fetch&&d.TextDecoderStream)return t(a,b,c,f);v(a,b,c,f)}function t(a,b,c,f){var e={"x-amzn-tiertwo":"yes"};"javaCheckoutPreInitiate:"===b&&(e["x-amz-checkout-transition"]="ajax");a=fetch(a,{headers:e,cache:"no-store"}).then(function(a){var d=a.body.pipeThrough(new TextDecoderStream).getReader(),e="";return d.read().then(function B(a){if(a.done){if(""===e.trim())return h(b+"prefetch_ajax_streaming_nodata",1),null;throw Error("Could not read JSON data from prefetch endpoint");
}e+=a.value;try{var g=JSON.parse(e)}catch(C){return d.read().then(B)}c&&c(g,f);h(b+"prefetch_ajax_streaming_success",1);return g})}).catch(function(a){var c={message:"streamJSONUsingFetch failed"};d.ueLogError&&(c=c||{},c.logLevel=c.logLevel||"ERROR",c.attribution=c.attribution||"CheckoutCartPrefetchAsset: Website \x3e Amazon Checkout Pipeline \x3e Others",c.message=c.message||"",d.ueLogError(a,c));h(b+"prefetch_ajax_streaming_error",1);return null}).then(function(a){g(a);return a});k(a,f);return a}
function v(a,c,d,f){var e={"x-amzn-tiertwo":"yes"};"javaCheckoutPreInitiate:"===c&&(e["x-amz-checkout-transition"]="ajax");a=b.$.ajax(a.toString(),{cache:!1,headers:e,success:function(a,b,e){d&&d(a,f);h(c+"prefetch_ajax_jquery_success",1);g(a);return a},error:function(){h(c+"prefetch_ajax_jquery_error",1);g();return null}});k(a,f)}var r=!1,x,y,u=!1;return{streamJSONPrefetchRequest:n,fireAndForgetPrefetchRequest:function(a,b){v(a,b,m,m)},getJavaCheckoutPreinitiateIdentifier:function(){return"javaCheckoutPreInitiate:"},
executionIdSuccessHandler:function(a,b){a&&a.executionHandle&&a.executionHandle.executionId&&c("preInitiateExecutionId",a.executionHandle.executionId)},javaCheckoutPreintiateSuccessHandler:w,javaCheckoutPreinitiate:function(){var a=(new Date).getTime();p();n("/checkout/entry/cart?isPreinit\x3d1\x26partialCheckoutCart\x3d1\x26pipelineType\x3dChewbacca\x26referrer\x3dcart","javaCheckoutPreInitiate:",w,a)},isTangoPreinitiateEligible:function(){var a=document.getElementById("checkout-url-server-migration-status");
return(u=a&&"true"===a.value)&&!r},customerEligibilityChangeHandler:function(a,b,c){b.checkoutUrl&&u&&(r=!a.checkoutUrl)&&(l(),c())},clearInvalidationTimer:q,setInvalidationTimeout:p,isAjaxCallBlocking:function(){return r},isJavaCheckoutServerStateEnabled:function(){return u},setAjaxBlockingFlag:function(a){r=a},getBuyBoxForm:f,clearValueInBuyBox:e,clearJavaPreinitValuesInBuyBox:l,insertValueInBuyBox:c,getBuyBoxParameters:function(a){if(!f())return[];for(var c=b.$("#sc-buy-box input").serializeArray(),
d={},e=0;e<c.length;e++)-1!==a.indexOf(c[e].name)&&(d[c[e].name]=c[e].value);return d},logUECounter:h}});"use strict";k.when("A","BYGServerSetting").register("BeforeYouCheckoutPagePrefetch",function(b,k){function g(f){h("byc_prefetch_ajax_call_initiate",1);b.$.ajax(f,{success:function(){h("prefetch_byc_ajax_jquery_success",1)},error:function(c){h("prefetch_byc_ajax_jquery_error",1);d.ueLogError&&d.ueLogError(c,{logLevel:"ERROR",attribution:"CheckoutCartPrefetchAsset: Website \x3e Amazon Checkout Pipeline \x3e Others",
message:"byc_firePrefetchRequest failed"})}})}function h(b,c){"undefined"!==typeof d.ue&&"undefined"!==typeof d.ue.count&&d.ue.count(b,c||1)}b.on("sc:byg:recs:added",function(f){h("byg_prefetch_converged_js_invoked",1);var c=b.$("a[name\x3dsc-byc-ptc-button]"),e=b.state("bygPageState").tangoUrl;c.attr("href")===e&&f.isTurbo||!k.features||!k.features.enableBYGPrefetch||(f=(new Date).getTime(),c=new URL("/gp/cart/checkout-prefetch.html",d.location.origin),c.searchParams.set("checkAuthentication","1"),
c.searchParams.set("checkDefaults","1"),c.searchParams.set("cartInitiateId",f),(e=(new URL(b.$("a[name\x3dsc-byc-ptc-button]").attr("href"),d.location.origin)).searchParams.get("partialCheckoutCart"))&&c.searchParams.set("partialCheckoutCart",e),g(c.href),c=b.$("a[name\x3dsc-byc-ptc-button]"),e=b.state("bygPageState").ingressUrl,e=new URL(e,d.location.origin),e.searchParams.has("cartInitiateId")&&(e.searchParams.set("cartInitiateId",f),c.attr("href",e.pathname+e.search)))})})});